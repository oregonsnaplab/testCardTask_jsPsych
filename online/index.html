<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>Wisconsin Card Sorting Test</title>
        <script src="../shared/languages.js"></script>
        <script src="../shared/parameters.js"></script>
        <script src="../shared/statCalculation.js"></script>
        <script src="../static/js/jspsych-6.1.0/jspsych.js"></script>
        <script src="../static/js/jspsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
        <script src="../static/js/jspsych-6.1.0/plugins/jspsych-fullscreen.js"></script>
        <script src="../static/js/jspsych-6.1.0/plugins/jspsych-instructions.js"></script>
        <script src="../static/js/jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="../shared/cards.js"></script>

        <!-- jsPsychSheet library -->
        <script src="https://brain2ai.github.io/jsPsychSheet/jspsychsheet.js"></script>
        <link rel="stylesheet" href="https://brain2ai.github.io/jsPsychSheet/jspsychsheet.css">

        <!-- jQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

        <link href="../static/js/jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"/>
        <link href="../static/css/style.css" rel="stylesheet" type="text/css"/>
    </head>
    <body>
        <script src="experiment.js"></script>

        <!-- ðŸ‘‡ This overrides the jsPsych.init with an on_finish function -->
        <script>
          // Wait until jsPsych is initialized in experiment.js, then patch it with upload behavior
          (function() {
            const originalInit = jsPsych.init;
            jsPsych.init = function(settings) {
              const originalOnFinish = settings.on_finish;
              settings.on_finish = function() {
                if (originalOnFinish) originalOnFinish();
                const sheetURL = "https://script.google.com/macros/s/AKfycbzWZnGEOn1EBuDsriyITaf0L3w6ZcBfv178O3DUmMnbPgpDKFk8elMBX2pW28z2aI9IUw/exec";
                jsPsychSheet.uploadData(sheetURL, jsPsych.data.get().csv());
              };
              originalInit(settings);
            };
          })();
        </script>
    </body>
</html>
